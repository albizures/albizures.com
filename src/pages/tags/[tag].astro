---
import { type CollectionEntry, getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Main from '../../layouts/Main.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import Card from '../../components/Card';
import slugify from '../../utils/slugify';
import { SITE } from '../../config';
import {
	filderByTag,
	sortCollection,
	getUniqueTags,
} from '../../utils/collections';

export type Props = {
	post: CollectionEntry<'blog'>;
	tag: string;
};

export async function getStaticPaths() {
	const posts = await getCollection('blog');

	const tags = getUniqueTags(posts);

	return tags.map((tag) => {
		return {
			params: { tag },
			props: { tag },
		};
	});
}

const { tag } = Astro.props;

const posts = await getCollection('blog', ({ data }) => !data.draft);

const tagPosts = filderByTag(posts, tag);

const sortTagsPost = sortCollection(tagPosts);
---

<Layout title={`Tag:${tag} | ${SITE.title}`}>
	<Header activeNav="tags" />
	<Main
		pageTitle={[`Tag:`, `${tag}`]}
		titleTransition={tag}
		pageDesc={`All the articles with the tag "${tag}".`}
	>
		<h1 slot="title" transition:name={tag}>{`Tag:${tag}`}</h1>
		<ul>
			{
				sortTagsPost.map(({ data }) => (
					<Card href={`/posts/${slugify(data)}`} frontmatter={data} />
				))
			}
		</ul>
	</Main>
	<Footer />
</Layout>
